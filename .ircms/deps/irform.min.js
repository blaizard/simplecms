var Irform=function(r,e,t){this.container=r,this.formDescription=e,this.options=$.extend(!0,{},Irform.defaultOptions,t),$(this.container).empty(),this.create(r,e)};Irform.CHAR_A_Z=1,Irform.CHAR_0_9=2,Irform.CHAR_SPACE=4,Irform.CHAR_SPECIAL=8,Irform.defaultOptions={fields:{input:function(r,e){var t=document.createElement("input");return $(t).prop("text"),$(t).prop("name",r),"string"==typeof e.placeholder&&$(t).prop("placeholder",e.placeholder),t},textarea:function(r,e){var t=document.createElement("textarea");return $(t).prop("name",r),"string"==typeof e.placeholder&&$(t).prop("placeholder",e.placeholder),t},select:function(r,e){var t=document.createElement("select");$(t).prop("name",r);for(var r in e.select){var a=document.createElement("option");$(a).text(e.select[r]),$(a).prop("value",r),$(t).append(a)}return t}},defaultType:"input",wrapper:function(r,e){var t=document.createElement("div"),a=document.createElement("span");$(a).text(e.caption);var i=document.createElement("span");return $(i).append(r),$(t).append(a),$(t).append(i),t},callbackError:function(r){var e="";for(var t in r)switch(r[t].type){case"required":e+="'"+r[t].options.caption+"' is required\n"}alert(e)},callbackSuccess:function(){},disable:function(r,e){var t=Irform.findNameElt(e);$(t).find("input,textarea,select").add(t).prop("disabled",r),Irform.queue(t,function(){$(t).trigger(r?"disable":"enable")})}},Irform.validate=function(r,e){return"string"==typeof e?(r&Irform.CHAR_A_Z&&(e=e.replace(/[a-z]/gi,"")),r&Irform.CHAR_0_9&&(e=e.replace(/[0-9]/g,"")),r&Irform.CHAR_SPACE&&(e=e.replace(/[ ]/g,"")),r&Irform.CHAR_SPECIAL&&(e=e.replace(/[!"#\$%&'\(\)\*\+,\-\.\/:;<=>\?@\[\\\]^_`\{\|\}~]/g,"")),""===e?!0:!1):!0},Irform.findNameElt=function(r,e){return"undefined"==typeof e&&(e=$(r).hasClass("irform-field")?$(r).attr("data-irform"):null),$(r).find("[name"+(e?"="+e:"")+"]").addBack("[name"+(e?"="+e:"")+"]").first()},Irform.prototype.create=function(r,e){for(var t in e){var a=this,i=$.extend({type:this.options.defaultType,required:!1,validate:null,disabled:!1,ignore:!1,options:{}},e[t]),n=i.type;if("function"==typeof this.options.fields[n]){var o=this.options.fields[n].call(this,t,i,function(){$(this).removeClass("irform-pending"),Irform.queue(this)}),s=Irform.findNameElt(o,t);$(s).on("change",function(){var r=$(this).val(),e=$(this).parents(".irform-field:first"),t=$(e).data("irform"),i=$(this).prop("name");r&&t.validate?a.validate(e,r)?a.options.callbackSuccess.call(a,e,i):a.options.callbackError.call(a,[{type:"validation",item:e,name:i,options:t}]):r&&$(e).hasClass("irform-required")&&a.options.callbackSuccess.call(a,e,i),"object"==typeof t.onchange&&($(this).data("nextElement")&&$(e).nextUntil($(this).data("nextElement")).remove(),$(this).data("nextElement",$(e).next()),"object"==typeof t.onchange[r]?a.create(e,t.onchange[r]):"object"==typeof t.onchange.__default__&&a.create(e,t.onchange.__default__))});var f=this.options.wrapper.call(this,o,i,t);$(f).addClass("irform-field"),$(f).attr("data-irform",t),i.required&&$(f).addClass("irform-required"),i.disabled&&Irform.queue(s,function(){a.options.disable.call(a,!0,$(this).parents(".irform-field:first"))}),$(f).data("irform",i),$(r).hasClass("irform-field")?$(r).after(f):$(r).append(f)}else console.log("'"+n+"' is not supported")}for(var t in e){var f=Irform.findNameElt(r,t);Irform.queue(f,function(){$(f).trigger("change")})}},Irform.prototype.update=function(r){var e=this.get(function(){},!0);$(this.container).empty(),this.formDescription=r,this.create(this.container,r),this.set(e)},Irform.prototype.ignore=function(r,e){var t=$(r).data("irform");t.ignore=e,$(r).data("irform",t)},Irform.prototype.validate=function(r,e){var t=$(r).data("irform");return"number"==typeof t.validate?Irform.validate(t.validate,e):"function"==typeof t.validate?t.validate.call(r,e):!0},Irform.prototype.get=function(r,e){var t=!1,a=[],i=this;"undefined"==typeof e&&(e=!1);var n=$();$(this.container).find(".irform-field").each(function(){n=n.add($("[name="+$(this).attr("data-irform")+"]"))});var o=Irform.get(n,function(n,o){var s=$(this).parents(".irform-field:first"),f=s.data("irform");if(!e){if(f.ignore)return null;if(!o&&f.required&&(a.push({type:"required",item:s,name:n,options:f}),t=!0),f.validate&&!i.validate(s,o)&&(a.push({type:"validation",item:s,name:n,options:f}),t=!0),"function"==typeof r){var l=r.call(i,s,n,o);if("undefined"!=typeof l)return l}}});return t?(this.options.callbackError.call(this,a),!1):o},Irform.prototype.set=function(r){var e={};do{var t=!1;Irform.set(this.container,r,function(r){return"undefined"!=typeof e[r]?null:(e[r]=!0,void(t=!0))})}while(t)},Irform.queue=function(r,e){if("function"==typeof e)if($(r).hasClass("irform-pending")){var t=$(r).data("irform-queue")||[];t.push(e),$(r).data("irform-queue",t)}else e.call(r);else{for(var t=$(r).data("irform-queue")||[];t.length;){var e=t.shift();e.call(r)}$(r).data("irform-queue",[])}},Irform.set=function(r,e,t){var a=$(r).find("[name]").addBack("[name]").not("a").filter(function(){var e=$(this).parent().closest("[name]");return 0==e.length||0==$(r).find(e).length&&0==$(r).filter(e).length});$(a).each(function(){var r=$(this).prop("name")||$(this).attr("name");if("undefined"!=typeof e[r]){var a=e[r];if("function"==typeof t){var i=t.call(this,r,a);if("undefined"!=typeof i){if(null===i)return;a=i}}Irform.queue(this,function(){$(this).val(a),$(this).trigger("change")})}})},Irform.get=function(r,e){var t={},a=$(r).find("[name]").addBack("[name]").not("a").filter(function(){var e=$(this).parent().closest("[name]");return 0==e.length||0==$(r).find(e).length&&0==$(r).filter(e).length});return $(a).each(function(){if(!$(this).hasClass("irform-pending")){var r=$(this).prop("name")||$(this).attr("name");if(r){var a=$(this).val();if("function"==typeof e){var i=e.call(this,r,a);if("undefined"!=typeof i){if(null===i)return;a=i}}t[r]=a}}}),t},Irform.clear=function(r){$(r).find(".irform-array").trigger("array-empty"),$(r).find("[name]").val("").trigger("change")},function(r){r.fn.irformArray=function(e,t){var a;return r(this).each(function(){a=r().irformArray.x.call(this,e,t)}),"undefined"==typeof a?r(this):a},r.fn.irformArray.x=function(e,t){var a=r.fn.irformArray.defaults,i="create";switch("string"==typeof e&&(i=e),"create"!=i&&r(this).data("irformArray")&&(a=r(this).data("irformArray")),"object"==typeof e&&(a=r.extend(!0,{},a,e)),r(this).data("irformArray",a),i){case"create":r.fn.irformArray.create.call(this);break;case"itemDelete":r.fn.irformArray.deleteItem.call(this,t);break;case"itemUp":r.fn.irformArray.moveItemUp.call(this,t);break;case"itemDown":r.fn.irformArray.moveItemDown.call(this,t)}},r.fn.irformArray.deleteItem=function(e){r(this).prop("disabled")!==!0&&r(e).remove()},r.fn.irformArray.moveItemUp=function(e){if(r(this).prop("disabled")!==!0){var t=r(e).prev(".irform-array-item");t.length&&(r(e).detach(),t.before(e))}},r.fn.irformArray.moveItemDown=function(e){if(r(this).prop("disabled")!==!0){var t=r(e).next(".irform-array-item");t.length&&(r(e).detach(),t.after(e))}},r.fn.irformArray.add=function(){var e=this,t=r(this).data("irformArray"),a=t.template,i=document.createElement("div");if(r(i).addClass("irform-array-item"),t.inline&&r(i).css("display","inline-block"),t.isDelete){var n=document.createElement("div");r(n).addClass("irform-array-item-del"),r(n).html(t["delete"]),r(n).click(function(){r.fn.irformArray.deleteItem.call(e,i)}),r(i).append(n)}if(t.isMove){var o=document.createElement("div");r(o).addClass("irform-array-item-up"),r(o).html(t.up),r(o).click(function(){r.fn.irformArray.moveItemUp.call(e,i)}),r(i).append(o);var s=document.createElement("div");r(s).addClass("irform-array-item-down"),r(s).html(t.down),r(s).click(function(){r.fn.irformArray.moveItemDown.call(e,i)}),r(i).append(s)}var f=document.createElement("div");r(f).addClass("irform-array-item-content"),r(f).html("function"==typeof a?a.call(e,i):r(a).clone(!0,!0)),r(i).append(f),r(this).find(".irform-array-content:first").append(i),t.hookAdd.call(e,i)},r.fn.irformArray.clear=function(){r(this).find(".irform-array-content:first").empty()},r.fn.irformArray.create=function(){var e=this,t=r(this).data("irformArray");r(e).empty(),r(e).addClass("irform-array"),r(e).attr("name",t.name);var a=document.createElement("div");if(r(a).addClass("irform-array-content"),t.inline&&r(a).css("display","inline-block"),r(e).append(a),r(e).on("array-add",function(){r.fn.irformArray.add.call(e)}),r(e).on("array-empty",function(){r.fn.irformArray.clear.call(e)}),t.isAdd){var i=document.createElement("div");r(i).addClass("irform-array-add"),r(i).html(t.add),t.inline&&r(i).css("display","inline-block"),r(i).click(function(){r(e).prop("disabled")!==!0&&r(e).trigger("array-add")}),r(e).append(i)}},r.fn.irformArray.defaults={name:null,template:'<input type="text" />',inline:!1,isDelete:!0,isAdd:!0,isMove:!0,"delete":"x",add:'<button type="button">Add</button>',up:"+",down:"-",hookAdd:function(){},hookValWrite:function(r){return r},hookValRead:function(r){return r}};var e=r.fn.val;r.fn.val=function(t){if(!arguments.length){if(r(this).hasClass("irform-array")){var t=[];r(this).children(".irform-array-content:first").children(".irform-array-item").each(function(r){t[r]=Irform.get(this)});var a=r(this).data("irformArray");return a.hookValRead.call(this,t)}return e.apply(this,arguments)}var i=t;return r(this).each(function(){var t=i;if(r(this).hasClass("irform-array")){var a=r(this).data("irformArray");t=a.hookValWrite.call(this,t),r(this).trigger("array-empty");for(var n in t){r(this).trigger("array-add");var o=r(this).children(".irform-array-content:first").children(".irform-array-item:last");Irform.set(o,t[n])}}else e.call(r(this),t)}),this}}(jQuery),Irform.defaultOptions.fields.array=function(r,e){var t=document.createElement("div");return $(t).irformArray({name:r,template:e.template}),t},function(r){r.fn.irformArrayKeywords=function(e){r(this).irformArray(r.extend(!0,r.fn.irformArrayKeywords.defaults,e))},r.fn.irformArrayKeywords.defaults={template:'<span style="margin-right: 10px;"><span class="irform-array-keywords-edit"><span class="irform-array-item-left">&lt;</span><input type="text" name="keyword"/><span class="irform-array-item-right">&gt;</span></span><span class="irform-array-keywords-tag" style="display: none;"><span></span><span class="irform-array-item-del" style="margin-left: 10px;">x</span></span></span>',isMove:!1,isDelete:!1,inline:!0,hookAdd:function(e){var t=this,a=r(e).find(".irform-array-keywords-edit"),i=r(e).find(".irform-array-keywords-tag");r(e).find("input").on("blur",function(){var n=r(this).val();n?(r(a).hide(),r(i).find("span:first").text(n),r(i).show()):r(t).irformArray("itemDelete",e)}).on("change",function(){r(this).trigger("blur")}),r(i).click(function(){r(t).prop("disabled")!==!0&&(r(t).find(".irform-array-item").not(e).find("input").trigger("blur"),r(this).hide(),r(a).show())}),r(e).find(".irform-array-item-left").click(function(){r(t).irformArray("itemUp",e)}),r(e).find(".irform-array-item-right").click(function(){r(t).irformArray("itemDown",e)}),r(e).find(".irform-array-item-del").click(function(){r(t).irformArray("itemDelete",e)}),r(this).find(".irform-array-item").not(e).find("input").trigger("blur")},hookValWrite:function(r){r=r.split(",");var e=[];for(var t in r){var a=r[t].trim();a&&e.push({keyword:a})}return e},hookValRead:function(r){for(var e in r)r[e]=r[e].keyword;return r.join(", ")}}}(jQuery),Irform.defaultOptions.fields.keywords=function(r){var e=document.createElement("div");return $(e).irformArrayKeywords({name:r}),e},function(r){r.fn.irformTinymce=function(e,t){var a;return r(this).each(function(){a=r().irformTinymce.x.call(this,e,t)}),"undefined"==typeof a?r(this):a},r.fn.irformTinymce.x=function(e){var t=r.fn.irformTinymce.defaults,a="create";switch("string"==typeof e&&(a=e),"create"!=a&&r(this).data("irformTinymce")&&(t=r(this).data("irformTinymce")),"object"==typeof e&&(t=r.extend(!0,{},t,e)),r(this).data("irformTinymce",t),a){case"create":r.fn.irformTinymce.create.call(this)}},r.fn.irformTinymce.create=function(){"undefined"==typeof r.fn.irformTinymce.create.id&&(r.fn.irformTinymce.create.id=0);var e=this,t=r(this).data("irformTinymce");r(this).addClass("irform-tinymce irform-pending"),r(this).attr("name",t.name),r(this).attr("id")||r(this).attr("id","irform-tinymce-id"+r.fn.irformTinymce.create.id++);var a=r.extend(!0,{selector:"#"+r(this).attr("id"),convert_urls:!1,file_browser_callback:function(a,i,n){t.callbackBrowser.call(e,n,function(e){r("#"+a).val(e)})},init_instance_callback:function(){t.callbackIsReady.call(e)},setup:function(t){t.on("change",function(){r(e).trigger("change")})}},t.tinymce);r(this).on("disable",function(){tinyMCE.get(r(this).prop("id")).setMode("readonly")}),r(this).on("enable",function(){tinyMCE.get(r(this).prop("id")).setMode("design")}),t.css&&(a.content_css=t.css),t.cssClass&&(a.body_class=t.cssClass),t.baseURL&&(a.document_base_url=t.baseURL),t.tinymceBase&&(tinymce.baseURL=t.tinymceBase),tinymce.suffix=".min",setTimeout(function(){tinymce.init(a)},100)},r.fn.irformTinymce.defaults={name:null,tinymceBase:null,baseURL:null,callbackIsReady:function(){},callbackBrowser:function(){},tinymce:{menubar:!1,statusbar:!1,autoresize_max_height:r(window).innerHeight(),toolbar:"undo redo | styleselect | bold italic | forecolor | removeformat | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media table | code | fullscreen",plugins:["advlist autolink autoresize link image lists charmap print preview hr anchor pagebreak spellchecker","searchreplace wordcount visualblocks visualchars code fullscreen insertdatetime media nonbreaking","save table contextmenu directionality emoticons template paste textcolor"]}};var e=r.fn.val;r.fn.val=function(t){return arguments.length?(r(this).each(function(){return r(this).hasClass("irform-tinymce")?tinyMCE.get(r(this).prop("id")).setContent(t):e.call(this,t)}),r(this)):r(this).hasClass("irform-tinymce")?tinyMCE.get(r(this).prop("id")).getContent():e.apply(this,arguments)}}(jQuery),Irform.defaultOptions.fields.htmleditor=function(r,e,t){var a=document.createElement("div");return $(a).irformTinymce($.extend(!0,{name:r,callbackIsReady:function(){t.call(this)}},e.tinymce)),a},Irform.defaultOptions.wrapper=function(r,e,t){var a=document.createElement("div");$(a).addClass("form-group"),$(a).css("clear","both");var i=document.createElement("a");$(i).prop("name","irform-anchor-"+t);var n=document.createElement("label");$(n).addClass("col-sm-2 control-label"),$(n).text("string"==typeof e.caption?e.caption:t);var o=document.createElement("fieldset");if($(o).addClass("col-sm-10"),$(r).is("input,textarea,select")&&$(r).addClass("form-control"),$(o).append(r),"undefined"!=typeof e.description){var s=document.createElement("small");$(s).addClass("form-text text-muted"),$(s).text(e.description),$(o).append(s)}return $(a).append(i),$(a).append(n),$(a).append(o),a},Irform.defaultOptions.callbackError=function(r){var e="";for(var t in r){switch(r[t].type){case"required":e+='<div class="irform-id-'+r[t].name+'"><a class="alert-link" href="#'+r[t].name+'">'+r[t].options.caption+"</a> is required</div>";break;case"validation":e+='<div class="irform-id-'+r[t].name+'"><a class="alert-link" href="#'+r[t].name+'">'+r[t].options.caption+"</a> does not validate</div>"}$(r[t].item).removeClass("has-success").addClass("has-error")}$(this.container).find(".irform-error").remove(),$(this.container).prepend('<div class="bs-component irform-error"><div class="alert alert-danger alert-dismissible" role="alert"><button type="button" class="close" data-dismiss="alert">x</button><div class="irform-message">'+e+"</div></div></div>")},Irform.defaultOptions.callbackSuccess=function(r,e){$(r).removeClass("has-error").addClass("has-success");var t=$(this.container).find(".irform-error");$(t).find(".irform-message .irform-id-"+e).remove(),$(t).find(".irform-message").text()||$(t).remove()};var IrformBootstrapSave=Irform.defaultOptions.disable;Irform.defaultOptions.disable=function(r,e){IrformBootstrapSave.call(this,r,e),$(e).find("fieldset").prop("disabled",r)},function(r){r.fn.irformArray.defaults.template='<input type="text" class="form-control" />',r.fn.irformArray.defaults.add='<button type="button" class="btn btn-info"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span> Add</button>',r.fn.irformArrayKeywords.defaults.template='<span style="margin-right: 10px;"><span class="irform-array-keywords-edit"><span class="irform-array-item-left glyphicon glyphicon-triangle-left" aria-hidden="true"></span><form class="form-inline" style="display: inline-block;"><input type="text" class="form-control" name="keyword"/></form><span class="irform-array-item-right glyphicon glyphicon-triangle-right" aria-hidden="true"></span></span><button type="button" class="irform-array-keywords-tag btn btn-default" style="display: none;"><span></span><span class="irform-array-item-del glyphicon glyphicon-remove" style="margin-left: 10px;" aria-hidden="true"></span></button></span>'}(jQuery);