!function(e){e.fn.irexplorer=function(r,t){var i;return e(this).each(function(){i=e().irexplorer.x.call(this,r,t)}),"undefined"==typeof i?e(this):i},e.fn.irexplorer.x=function(r){var t=e.fn.irexplorer.defaults,i="create";switch("string"==typeof r&&(i=r),this&&"create"!=i&&e(this).data("irexplorer")&&(t=e(this).data("irexplorer")),"object"==typeof r&&(t=e.extend(!0,{},t,r)),e(this).data("irexplorer",t),i){case"create":e.fn.irexplorer.create.call(this);break;case"path":return e.fn.irexplorer.getPath.call(this)}},e.fn.irexplorer.normalize=function(e){e=e.replace("\\","/"),result=[],pathArray=e.split("/"),pathArray[0]||result.push("");for(i in pathArray){var r=pathArray[i];".."==r?".."!=result[result.length-1]&&result.pop()||result.push(".."):r&&"."!=r&&result.push(r)}return pathArray[pathArray.length-1]||result.push(""),result=result.join("/"),""==result?"/":result},e.fn.irexplorer.create=function(){var r=e(this).data("irexplorer");if(r.relative===!0&&(r.relative=r.irexplorer.current),"undefined"==typeof r.viewList[r.view]){var t;for(t in r.viewList)break;r.view=t}e(this).data("irexplorer",r),e(this).empty(),r.create.call(this),e.fn.irexplorer.fetch.call(this,r.irexplorer.current)},e.fn.irexplorer.onClick=function(r,t){var i=e(this).data("irexplorer"),a=e.fn.irexplorer.getPath.call(this,r);return i.onClick.call(this,a,t)===!1?!1:("folder"==t&&e.fn.irexplorer.fetch.call(this,r),!0)},e.fn.irexplorer.onDblClick=function(r,t){var i=e(this).data("irexplorer"),a=e.fn.irexplorer.getPath.call(this,r);return i.onDblClick.call(this,a,t)===!1?!1:!0},e.fn.irexplorer.getPath=function(r){var t=e(this).data("irexplorer");"undefined"==typeof r&&(r=t.irexplorer.current);var i=r;if(t.relative){var a=t.relative,l=r.replace(/^\s*\/*|\/*\s*$/g,"").split("/"),o=a.replace(/^\s*\/*|\/*\s*$/g,"").split("/");for(i="";"undefined"!=typeof l[0]&&"undefined"!=typeof o[0]&&l[0]==o[0];)l.shift(),o.shift();for(;o.pop();)i+="../";i+=l.join("/"),i=i.replace(/\/+$/,""),r=(""==i?".":i)+("/"==r.slice(-1)?"/":"")}return r},e.fn.irexplorer.data=function(r){var t=e(this).data("irexplorer"),i=[];for(var a in r.data){var l=r.data[a].d;for(var o in l)l[o]=["function"==typeof t.format[o]?t.format[o].call(this,l[o]):l[o],l[o]];i.push({d:l,a:r.data[a].a})}t.update.call(this,r.columns,i,t.view),t.onLoad.call(this)},e.fn.irexplorer.fetch=function(r){var t=e(this).data("irexplorer");t.irexplorer.current=e.fn.irexplorer.normalize(r+"/"),e(this).data("irexplorer",t);var i=t.view;if("object"!=typeof t.viewList[i])return void t.onError.call(this,"Unsupported view `"+i+"'");"undefined"==typeof t.irexplorer.args&&(t.irexplorer.args=[]);for(var a in t.viewList[i]){var l=t.viewList[i][a];-1==jQuery.inArray(l,t.irexplorer.args)&&t.irexplorer.args.push(l)}t.fetch.call(this,t.irexplorer)},e.fn.irexplorer.viewList=function(r,t){var a=this,l=document.createElement("table"),o=document.createElement("thead"),n=document.createElement("tr");e(n).append("<th></th>");for(i in r){var p=document.createElement("th");e(p).text(r[i].name),e(n).append(p)}e(o).append(n);var d=document.createElement("tbody");for(i in t){var n=document.createElement("tr"),s=document.createElement("td");e(s).append(e.fn.irexplorer.thumbnail.call(this,t[i].a.thumbnail,24,24)),e(n).append(s);for(j in r){var c=r[j].id,s=document.createElement("td");"object"==typeof t[i].d[c]&&e(s).text(t[i].d[c][0]),e(n).append(s)}e(n).data("irexplorer",t[i].a),e(n).on("click",function(){var r=e(this).data("irexplorer");e.fn.irexplorer.onClick.call(a,r.path,r.type)}),e(n).dblclick(function(){var r=e(this).data("irexplorer");e.fn.irexplorer.onDblClick.call(a,r.path,r.type)}),e(d).append(n)}e(l).append(o),e(l).append(d),e(this).find(".irexplorer-container").append(l)},e.fn.irexplorer.thumbnail=function(r,t,i){var a=e(this).data("irexplorer"),l=Ircom.urlParam(a.apiURL,"irexplorer","thumbnail");l=Ircom.urlParam(l,"irexplorer-thumb",r),l=Ircom.urlParam(l,"irexplorer-size",Math.max(t,i));var o=document.createElement("div");return e(o).addClass("irexplorer-thumbnail"),e(o).css({backgroundImage:"url("+l+")",backgroundSize:"contain",backgroundPosition:"center",backgroundRepeat:"no-repeat",width:t+"px",height:i+"px"}),o},e.fn.irexplorer.viewThumbnails=function(r,t,a,l){var o=this;"undefined"==typeof a&&(a=100,l=100);var n=document.createElement("div");for(i in t){var p=document.createElement("div");e(p).css({"float":"left",margin:"10px",width:a+"px",height:l+15+"px",paddingBottom:"20px",textAlign:"center",overflow:"hidden",fontSize:"10px",fontWeight:"bold",whiteSpace:"nowrap"}),e(p).append(e.fn.irexplorer.thumbnail.call(this,t[i].a.thumbnail,a,l));var d=document.createElement("div");e(d).text(t[i].a.name),e(p).append(d),e(p).data("irexplorer",t[i].a),e(p).on("click",function(){var r=e(this).data("irexplorer");e.fn.irexplorer.onClick.call(o,r.path,r.type)}),e(p).dblclick(function(){var r=e(this).data("irexplorer");e.fn.irexplorer.onDblClick.call(o,r.path,r.type)}),e(n).append(p)}e(n).append('<div style="clear: both;"></div>'),e(this).find(".irexplorer-container").append(n)},e.fn.irexplorer.defaults={apiURL:"api.php",relative:!1,view:"list",viewList:{list:["type","path","thumbnail"],thumbnails:["type","path","thumbnail","name"]},irexplorer:{current:"/"},format:{type:function(e){return"folder"==e?"File Folder":e.toUpperCase()+" File"},size:function(e){if(""===e)return"-";var r=parseInt(e),t=-1,i=[" kB"," MB"," GB"," TB"];do r/=1024,t++;while(t<i.length-1&&r>1024);return Math.max(r,.1).toFixed(1)+i[t]},date:function(e){var r=new Date(1e3*parseInt(e));return(r.getDate()<10?"0":"")+r.getDate()+"."+(r.getMonth()+1<10?"0":"")+(r.getMonth()+1)+"."+r.getFullYear()+" "+(r.getHours()<10?"0":"")+r.getHours()+":"+(r.getMinutes()<10?"0":"")+r.getMinutes()}},create:function(){var r=e(this).data("irexplorer"),t=this,i=document.createElement("div");e(i).addClass("irexplorer-header");for(var a in r.viewList){var l=document.createElement("a");e(l).addClass("irexplorer-view irexplorer-view-"+a),e(l).data("irexplorer",a),e(l).text(a),e(l).click(function(){var r=e(t).data("irexplorer");r.view=e(this).data("irexplorer"),e(t).data("irexplorer",r),e.fn.irexplorer.fetch.call(t,r.irexplorer.current)}),e(i).append(l)}e(this).append(i);var o=document.createElement("div");e(o).addClass("irexplorer-container"),e(this).append(o)},update:function(r,t,i){switch(i){case"list":e.fn.irexplorer.viewList.call(this,r,t);break;case"thumbnails":e.fn.irexplorer.viewThumbnails.call(this,r,t)}},fetch:function(r){e(this).find(".irexplorer-container").empty();var t=e(this).data("irexplorer"),i={args:this,onSuccess:function(r,t){var i=t.args;e.fn.irexplorer.data.call(i,r)},onError:function(r,t){var i=t.args;t=e(i).data("irexplorer"),t.onError.call(i,r)}};Ircom(Ircom.urlParam(t.apiURL,"irexplorer","fetch"),r,i)},onClick:function(){},onDblClick:function(){},onLoad:function(){},onError:function(e){console.log(e)}}}(jQuery),IrexplorerDialog=function(e){this.options=$.extend(!0,{},IrexplorerDialog.defaultOptions,IrexplorerDialog.defaultOptions.presets[e.mode],e,{_irexplorerDialog:this,_irexplorer:document.createElement("span")});var r=this,t=this.options._irexplorer;this.options.dialogCreate.call(this,this.options,function(){return $(t).irexplorer(r.options),t})},IrexplorerDialog.prototype.getIrexplorer=function(){return this.options._irexplorer},IrexplorerDialog.prototype.getDialog=function(){return $(this.getIrexplorer()).parents(".irexplorer-dialog:first")},IrexplorerDialog.prototype.validate=function(){var e=$(this.getDialog()).find(".irexplorer-path").val();this.options.dialogClose.call(this),this.options.onValidate.call(this,e)},IrexplorerDialog.fromIrexplorer=function(e){var r=$(e).data("irexplorer");return r._irexplorerDialog},IrexplorerDialog.defaultOptions={title:"File Browser",mode:"file",presets:{file:{},directory:{irexplorer:{show:["name","date"],showType:["folder"]}},image:{view:"thumbnails",irexplorer:{showType:["folder","(gif|jpg|png|bmp)"]}}},dialogCreate:function(e,r){var t=this,i=document.createElement("div");$(i).addClass("irexplorer-dialog");var a=document.createElement("h1");$(a).text(e.title),$(i).append(a);var l=document.createElement("div");$(l).append(r()),$(i).append('<div><input type="text" class="irexplorer-path"/></div>'),$(i).append(l);var o=document.createElement("button");$(o).attr("type","button"),$(o).text("select"),$(o).click(function(){t.validate(),$(i).remove()}),$(i).append(o),$("body").prepend(i)},dialogClose:function(){$(this.getDialog()).remove()},onClick:function(e){var r=IrexplorerDialog.fromIrexplorer(this);$(r.getDialog()).find("input.irexplorer-path").val(e)},onDblClick:function(){var e=IrexplorerDialog.fromIrexplorer(this);e.validate()},onValidate:function(e){alert(e)},onLoad:function(){var e=IrexplorerDialog.fromIrexplorer(this);$(e.getDialog()).find("input.irexplorer-path").val($(this).irexplorer("path"))}};var irexplorerUpdateOriginal=$().irexplorer.defaults.update,irexplorerCreateOriginal=$().irexplorer.defaults.create;!function(e){e.fn.irexplorer.defaults.create=function(){irexplorerCreateOriginal.call(this),e(this).find(".irexplorer-header").css("text-align","right"),e(this).find(".irexplorer-header .irexplorer-view").wrap("<li></li>").parent().wrapAll('<ul class="pagination"></ul>'),e(this).find(".irexplorer-header .irexplorer-view-list").html('&nbsp;<span class="glyphicon glyphicon-th-list" aria-hidden="true"></span>&nbsp;'),e(this).find(".irexplorer-header .irexplorer-view-thumbnails").html('&nbsp;<span class="glyphicon glyphicon-th" aria-hidden="true"></span>&nbsp;')},e.fn.irexplorer.defaults.update=function(r,t,i){switch(irexplorerUpdateOriginal.call(this,r,t,i),i){case"list":e(this).find("table").addClass("table table-hover");break;case"thumbnails":e(this).find(".irexplorer-thumbnail").css({borderRadius:"5px",border:"1px solid #ccc"})}e(this).find(".irexplorer-header .irexplorer-view").parent().removeClass("active"),e(this).find(".irexplorer-header .irexplorer-view-"+i).parent().addClass("active")}}(jQuery),IrexplorerDialog.defaultOptions.dialogCreate=function(e,r){var t=this,i=document.createElement("div");$(i).addClass("modal fade irexplorer-dialog"),$(i).css("z-index","2147483647"),$(i).prop("role","dialog");var a=document.createElement("div");$(a).addClass("modal-dialog modal-lg");var l=document.createElement("div");$(l).addClass("modal-content");var o=document.createElement("div");$(o).addClass("modal-header"),$(o).html("<h2>"+$("<div/>").html(e.title).text()+"</h2>"),$(l).append(o);var n=document.createElement("div");$(n).addClass("modal-body");var p=document.createElement("div");$(p).addClass("input-group"),$(p).append('<span class="input-group-addon">Path</span>');var d=document.createElement("input");$(d).prop("type","text"),$(d).addClass("form-control irexplorer-path"),$(p).append(d),$(n).append(p),$(n).append(r()),$(l).append(n);var s=document.createElement("div");$(s).addClass("modal-footer"),$(s).append('<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>');var c=document.createElement("button");$(c).addClass("btn btn-primary"),$(c).attr("type","button"),$(c).text("Select"),$(c).click(function(){t.validate()}),$(s).append(c),$(l).append(s),$(a).append(l),$(i).append(a),$(i).modal()},IrexplorerDialog.defaultOptions.dialogClose=function(){$(this.getDialog()).modal("hide")};